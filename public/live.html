<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Playlist - NeoN VJ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Header -->
    <header class="bg-black/50 backdrop-blur-sm border-b border-gray-800 sticky top-0 z-10">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 id="eventName" class="text-xl font-semibold">Loading...</h1>
                    <div class="flex items-center gap-2 text-sm text-gray-400">
                        <span>ğŸ“…</span>
                        <span id="eventDate">--/--/--</span>
                        <span>â€¢</span>
                        <span id="songCount">0 songs</span>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <!-- Language Selector -->
                    <div class="relative">
                        <select id="languageSelector" 
                                onchange="changeLanguage(this.value)"
                                class="px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm text-white appearance-none cursor-pointer pr-8 focus:outline-none focus:border-purple-500">
                            <option value="" disabled>Language</option>
                            <option value="ja" selected>ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                            <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                            <option value="zh-Hans">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡</option>
                            <option value="zh-Hant">ğŸ‡¹ğŸ‡¼ ç¹é«”ä¸­æ–‡</option>
                            <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                            <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                            <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                            <option value="th">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</option>
                        </select>
                        <!-- Custom dropdown arrow -->
                        <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </div>
                    </div>
                    <!-- Share Button -->
                    <button onclick="shareEvent()" 
                            id="shareButton"
                            class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm font-medium transition">
                        Share
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6 max-w-2xl">
        <!-- DJ Filter -->
        <div class="mb-6">
            <select id="djFilter" 
                    onchange="filterByDJ()"
                    class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white">
                <option value="all">All DJs</option>
            </select>
        </div>

        <!-- Event URL (if provided) -->
        <div id="eventUrlSection" class="mb-6 hidden">
            <a id="eventUrl" href="#" target="_blank" rel="noopener noreferrer"
               class="text-purple-400 hover:text-purple-300 text-sm">
                ğŸŒ <span id="eventUrlText"></span>
            </a>
        </div>

        <!-- Playlist Container -->
        <div id="playlistContainer" class="space-y-2">
            <!-- Songs will be inserted here -->
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="text-center py-12">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-purple-400"></div>
            <p class="text-gray-400 mt-4">Loading playlist...</p>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="text-center py-12 hidden">
            <p class="text-gray-400">ã¾ã æ¥½æ›²ãŒå†ç”Ÿã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚æœ€åˆã®æ¥½æ›²ã‚’ãŠå¾…ã¡ãã ã•ã„...</p>
        </div>

        <!-- Notice -->
        <div class="mt-8 bg-yellow-900/20 border border-yellow-800 rounded-lg p-4">
            <p class="text-yellow-200 text-sm">
                âš ï¸ èªè­˜ã«å¤±æ•—ã—ãŸæ¥½æ›²ã¯è¡¨ç¤ºã•ã‚Œãªã„å ´åˆãŒã‚ã‚Šã¾ã™<br>
                ğŸ—“ï¸ ã“ã®ãƒšãƒ¼ã‚¸ã¯30æ—¥å¾Œã«è‡ªå‹•å‰Šé™¤ã•ã‚Œã¾ã™
            </p>
        </div>
    </main>

    <!-- Footer -->
    <footer class="mt-auto border-t border-gray-800 bg-black/50">
        <div class="container mx-auto px-4 py-6 text-center">
            <p class="text-gray-400 text-sm">
                Powered by NeoN VJ
            </p>
            <p class="text-gray-500 text-xs mt-1">
                Â© 2025 SMYLE | Produced by NeoN
            </p>
        </div>
    </footer>

    <script>
        // Translations object for all 8 languages
        const translations = {
            'ja': {
                'share.button': 'ã‚·ã‚§ã‚¢',
                'share.title': 'NeoN VJ ãƒ©ã‚¤ãƒ–ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ',
                'share.text': 'ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’ãƒã‚§ãƒƒã‚¯ï¼',
                'share.copied': 'URLã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼',
                'filter.all': 'ã™ã¹ã¦ã®DJ',
                'loading.message': 'ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­...',
                'empty.message': 'ã¾ã æ¥½æ›²ãŒå†ç”Ÿã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚æœ€åˆã®æ¥½æ›²ã‚’ãŠå¾…ã¡ãã ã•ã„...',
                'error.not_found': 'ã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
                'notice.recognition': 'âš ï¸ èªè­˜ã«å¤±æ•—ã—ãŸæ¥½æ›²ã¯è¡¨ç¤ºã•ã‚Œãªã„å ´åˆãŒã‚ã‚Šã¾ã™',
                'notice.deletion': 'ğŸ—“ï¸ ã“ã®ãƒšãƒ¼ã‚¸ã¯30æ—¥å¾Œã«è‡ªå‹•å‰Šé™¤ã•ã‚Œã¾ã™',
                'footer.powered': 'Powered by NeoN VJ',
                'now.tag': 'Now',
                'songs.count': 'æ›²'
            },
            'en': {
                'share.button': 'Share',
                'share.title': 'NeoN VJ Live Playlist',
                'share.text': 'Check out this event playlist!',
                'share.copied': 'URL copied to clipboard!',
                'filter.all': 'All DJs',
                'loading.message': 'Loading playlist...',
                'empty.message': 'No songs played yet. Waiting for the first song...',
                'error.not_found': 'Event not found',
                'notice.recognition': 'âš ï¸ Songs that failed recognition may not be displayed',
                'notice.deletion': 'ğŸ—“ï¸ This page will be automatically deleted after 30 days',
                'footer.powered': 'Powered by NeoN VJ',
                'now.tag': 'Now',
                'songs.count': 'songs'
            },
            'zh-Hans': {
                'share.button': 'åˆ†äº«',
                'share.title': 'NeoN VJ ç°åœºæ’­æ”¾åˆ—è¡¨',
                'share.text': 'æŸ¥çœ‹è¿™ä¸ªæ´»åŠ¨çš„æ’­æ”¾åˆ—è¡¨ï¼',
                'share.copied': 'URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼',
                'filter.all': 'æ‰€æœ‰DJ',
                'loading.message': 'æ­£åœ¨åŠ è½½æ’­æ”¾åˆ—è¡¨...',
                'empty.message': 'è¿˜æ²¡æœ‰æ’­æ”¾æ­Œæ›²ã€‚ç­‰å¾…ç¬¬ä¸€é¦–æ­Œæ›²...',
                'error.not_found': 'æ‰¾ä¸åˆ°æ´»åŠ¨',
                'notice.recognition': 'âš ï¸ è¯†åˆ«å¤±è´¥çš„æ­Œæ›²å¯èƒ½ä¸ä¼šæ˜¾ç¤º',
                'notice.deletion': 'ğŸ—“ï¸ æ­¤é¡µé¢å°†åœ¨30å¤©åè‡ªåŠ¨åˆ é™¤',
                'footer.powered': 'ç”± NeoN VJ æä¾›æ”¯æŒ',
                'now.tag': 'Now',
                'songs.count': 'é¦–æ­Œæ›²'
            },
            'zh-Hant': {
                'share.button': 'åˆ†äº«',
                'share.title': 'NeoN VJ ç¾å ´æ’­æ”¾æ¸…å–®',
                'share.text': 'æŸ¥çœ‹é€™å€‹æ´»å‹•çš„æ’­æ”¾æ¸…å–®ï¼',
                'share.copied': 'URLå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼',
                'filter.all': 'æ‰€æœ‰DJ',
                'loading.message': 'æ­£åœ¨è¼‰å…¥æ’­æ”¾æ¸…å–®...',
                'empty.message': 'é‚„æ²’æœ‰æ’­æ”¾æ­Œæ›²ã€‚ç­‰å¾…ç¬¬ä¸€é¦–æ­Œæ›²...',
                'error.not_found': 'æ‰¾ä¸åˆ°æ´»å‹•',
                'notice.recognition': 'âš ï¸ è­˜åˆ¥å¤±æ•—çš„æ­Œæ›²å¯èƒ½ä¸æœƒé¡¯ç¤º',
                'notice.deletion': 'ğŸ—“ï¸ æ­¤é é¢å°‡åœ¨30å¤©å¾Œè‡ªå‹•åˆªé™¤',
                'footer.powered': 'ç”± NeoN VJ æä¾›æ”¯æ´',
                'now.tag': 'Now',
                'songs.count': 'é¦–æ­Œæ›²'
            },
            'ko': {
                'share.button': 'ê³µìœ ',
                'share.title': 'NeoN VJ ë¼ì´ë¸Œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸',
                'share.text': 'ì´ ì´ë²¤íŠ¸ì˜ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”!',
                'share.copied': 'URLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!',
                'filter.all': 'ëª¨ë“  DJ',
                'loading.message': 'í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë¡œë”© ì¤‘...',
                'empty.message': 'ì•„ì§ ì¬ìƒëœ ê³¡ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ê³¡ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...',
                'error.not_found': 'ì´ë²¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤',
                'notice.recognition': 'âš ï¸ ì¸ì‹ì— ì‹¤íŒ¨í•œ ê³¡ì€ í‘œì‹œë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤',
                'notice.deletion': 'ğŸ—“ï¸ ì´ í˜ì´ì§€ëŠ” 30ì¼ í›„ ìë™ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤',
                'footer.powered': 'Powered by NeoN VJ',
                'now.tag': 'Now',
                'songs.count': 'ê³¡'
            },
            'fr': {
                'share.button': 'Partager',
                'share.title': 'NeoN VJ Playlist Live',
                'share.text': 'DÃ©couvrez la playlist de cet Ã©vÃ©nement!',
                'share.copied': 'URL copiÃ©e dans le presse-papiers!',
                'filter.all': 'Tous les DJs',
                'loading.message': 'Chargement de la playlist...',
                'empty.message': 'Aucune chanson jouÃ©e. En attente de la premiÃ¨re chanson...',
                'error.not_found': 'Ã‰vÃ©nement non trouvÃ©',
                'notice.recognition': 'âš ï¸ Les chansons non reconnues peuvent ne pas s\'afficher',
                'notice.deletion': 'ğŸ—“ï¸ Cette page sera automatiquement supprimÃ©e aprÃ¨s 30 jours',
                'footer.powered': 'PropulsÃ© par NeoN VJ',
                'now.tag': 'Now',
                'songs.count': 'chansons'
            },
            'es': {
                'share.button': 'Compartir',
                'share.title': 'NeoN VJ Lista en Vivo',
                'share.text': 'Â¡Mira la lista de este evento!',
                'share.copied': 'Â¡URL copiada al portapapeles!',
                'filter.all': 'Todos los DJs',
                'loading.message': 'Cargando lista...',
                'empty.message': 'No hay canciones reproducidas. Esperando la primera canciÃ³n...',
                'error.not_found': 'Evento no encontrado',
                'notice.recognition': 'âš ï¸ Las canciones no reconocidas pueden no mostrarse',
                'notice.deletion': 'ğŸ—“ï¸ Esta pÃ¡gina se eliminarÃ¡ automÃ¡ticamente despuÃ©s de 30 dÃ­as',
                'footer.powered': 'Desarrollado por NeoN VJ',
                'now.tag': 'Now',
                'songs.count': 'canciones'
            },
            'th': {
                'share.button': 'à¹à¸Šà¸£à¹Œ',
                'share.title': 'NeoN VJ à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œà¸ªà¸”',
                'share.text': 'à¸”à¸¹à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œà¸‚à¸­à¸‡à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸™à¸µà¹‰!',
                'share.copied': 'à¸„à¸±à¸”à¸¥à¸­à¸ URL à¹„à¸›à¸¢à¸±à¸‡à¸„à¸¥à¸´à¸›à¸šà¸­à¸£à¹Œà¸”à¹à¸¥à¹‰à¸§!',
                'filter.all': 'DJ à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”',
                'loading.message': 'à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ...',
                'empty.message': 'à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¹€à¸à¸¥à¸‡à¸—à¸µà¹ˆà¹€à¸¥à¹ˆà¸™ à¸à¸³à¸¥à¸±à¸‡à¸£à¸­à¹€à¸à¸¥à¸‡à¹à¸£à¸...',
                'error.not_found': 'à¹„à¸¡à¹ˆà¸à¸šà¸à¸´à¸ˆà¸à¸£à¸£à¸¡',
                'notice.recognition': 'âš ï¸ à¹€à¸à¸¥à¸‡à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸£à¸°à¸šà¸¸à¹„à¸”à¹‰à¸­à¸²à¸ˆà¹„à¸¡à¹ˆà¹à¸ªà¸”à¸‡',
                'notice.deletion': 'ğŸ—“ï¸ à¸«à¸™à¹‰à¸²à¸™à¸µà¹‰à¸ˆà¸°à¸–à¸¹à¸à¸¥à¸šà¹‚à¸”à¸¢à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¸«à¸¥à¸±à¸‡à¸ˆà¸²à¸ 30 à¸§à¸±à¸™',
                'footer.powered': 'à¸‚à¸±à¸šà¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¹‚à¸”à¸¢ NeoN VJ',
                'now.tag': 'Now',
                'songs.count': 'à¹€à¸à¸¥à¸‡'
            }
        };

        // Current language - default to Japanese
        let currentLanguage = localStorage.getItem('neon-vj-language') || 'ja';

        // Configuration
        const UPDATE_INTERVAL = 60000; // 60 seconds
        let eventId = null;
        let eventData = null;
        let songs = [];
        let updateTimer = null;
        
        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            // Initialize language
            initializeLanguage();
            
            // Get event ID from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            eventId = urlParams.get('event');
            
            if (eventId) {
                loadEventData();
                updateTimer = setInterval(loadEventData, UPDATE_INTERVAL);
            }
        });

        // Initialize language system
        function initializeLanguage() {
            // Set language selector to current language
            const selector = document.getElementById('languageSelector');
            selector.value = currentLanguage;
            
            // Set HTML lang attribute
            document.documentElement.lang = currentLanguage;
            
            // Update initial UI elements
            updateStaticTranslations();
        }

        // Change language
        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('neon-vj-language', lang);
            
            // Update HTML lang attribute
            document.documentElement.lang = lang;
            
            // Update language selector
            document.getElementById('languageSelector').value = lang;
            
            // Update all translatable elements
            updateStaticTranslations();
            
            // Refresh dynamic content if available
            if (eventData) {
                updateUI();
            }
        }

        // Update static translations
        function updateStaticTranslations() {
            const t = translations[currentLanguage];
            
            // Update share button
            const shareButton = document.getElementById('shareButton');
            if (shareButton) {
                shareButton.textContent = t['share.button'];
            }
            
            // Update DJ filter
            const djFilter = document.getElementById('djFilter');
            if (djFilter && djFilter.options.length > 0) {
                djFilter.options[0].textContent = t['filter.all'];
            }
            
            // Update loading state
            const loadingState = document.getElementById('loadingState');
            if (loadingState) {
                const loadingText = loadingState.querySelector('p');
                if (loadingText) {
                    loadingText.textContent = t['loading.message'];
                }
            }
            
            // Update empty state
            const emptyState = document.getElementById('emptyState');
            if (emptyState) {
                const emptyText = emptyState.querySelector('p');
                if (emptyText) {
                    emptyText.textContent = t['empty.message'];
                }
            }
            
            // Update notice section
            const noticeSection = document.querySelector('.bg-yellow-900\\/20 p');
            if (noticeSection) {
                noticeSection.innerHTML = `
                    ${t['notice.recognition']}<br>
                    ${t['notice.deletion']}
                `;
            }
            
            // Update footer
            const footerText = document.querySelector('footer .text-gray-400');
            if (footerText) {
                footerText.textContent = t['footer.powered'];
            }
        }
        
        // Load event data from JSON
        async function loadEventData() {
            try {
                const response = await fetch(`https://neon-vj-setlist-api.netlify.app/.netlify/functions/event-get-fixed?eventId=${eventId}`);
                if (!response.ok) throw new Error('Event not found');
                
                const data = await response.json();
                eventData = data.event;
                songs = data.songs || [];
                
                updateUI();
            } catch (error) {
                console.error('Failed to load event data:', error);
                document.getElementById('loadingState').innerHTML = `
                    <p class="text-red-400">${translations[currentLanguage]['error.not_found']}</p>
                `;
            }
        }
        
        // Update UI with event data
        function updateUI() {
            // Hide loading state
            document.getElementById('loadingState').classList.add('hidden');
            
            // Update event info
            document.getElementById('eventName').textContent = eventData.name || 'Live Event';
            document.getElementById('songCount').textContent = `${songs.length} ${translations[currentLanguage]['songs.count']}`;
            
            // Update event date (format: YYYY/MM/DD)
            if (eventData.created_at) {
                const eventDate = new Date(eventData.created_at);
                const formatDate = eventDate.toLocaleDateString('ja-JP', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                });
                document.getElementById('eventDate').textContent = formatDate;
            }
            
            // Update event URL if exists
            if (eventData.event_url) {
                document.getElementById('eventUrlSection').classList.remove('hidden');
                document.getElementById('eventUrl').href = eventData.event_url;
                document.getElementById('eventUrlText').textContent = eventData.event_url;
            }
            
            // Update DJ filter
            updateDJFilter();
            
            // Display songs
            displaySongs();
        }
        
        // Update DJ filter options
        function updateDJFilter() {
            const djSet = new Set(songs.map(s => s.dj_name));
            const djFilter = document.getElementById('djFilter');
            
            // Keep "All DJs" option
            djFilter.innerHTML = `<option value="all">${translations[currentLanguage]['filter.all']}</option>`;
            
            // Add DJ options
            djSet.forEach(dj => {
                const option = document.createElement('option');
                option.value = dj;
                option.textContent = dj;
                djFilter.appendChild(option);
            });
        }
        
        // Display songs based on filter
        function displaySongs() {
            const container = document.getElementById('playlistContainer');
            const filter = document.getElementById('djFilter').value;
            
            // Filter songs
            let filteredSongs = songs;
            if (filter !== 'all') {
                filteredSongs = songs.filter(s => s.dj_name === filter);
            }
            
            // Show empty state if no songs
            if (filteredSongs.length === 0) {
                document.getElementById('emptyState').classList.remove('hidden');
                container.innerHTML = '';
                return;
            }
            
            document.getElementById('emptyState').classList.add('hidden');
            
            // Display mode based on event settings
            const displayMode = eventData.dj_display_mode || 'chronological';
            
            if (displayMode === 'grouped') {
                displaySongsGrouped(filteredSongs);
            } else {
                displaySongsChronological(filteredSongs);
            }
        }
        
        // Display songs in chronological order
        function displaySongsChronological(songList) {
            const container = document.getElementById('playlistContainer');
            container.innerHTML = '';
            
            // Sort by timestamp (newest first)
            const sortedSongs = [...songList].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            sortedSongs.forEach((song, index) => {
                // é€šã—ç•ªå·ã¯å…¨æ¥½æ›²æ•°ã‹ã‚‰é€†ç®—ï¼ˆæ–°ã—ã„ã»ã©å¤§ãã„ç•ªå·ï¼‰
                const songNumber = sortedSongs.length - index;
                const songEl = createSongElement(song, index === 0, false, songNumber);
                container.appendChild(songEl);
            });
        }
        
        // Display songs grouped by DJ
        function displaySongsGrouped(songList) {
            const container = document.getElementById('playlistContainer');
            container.innerHTML = '';
            
            // å…¨æ¥½æ›²ã‚’æ™‚ç³»åˆ—ã§ã‚½ãƒ¼ãƒˆã—ã¦é€šã—ç•ªå·ã‚’æ±ºå®š
            const sortedAllSongs = [...songList].sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            const songNumberMap = {};
            sortedAllSongs.forEach((song, index) => {
                const key = `${song.title}_${song.artist}_${song.timestamp}`;
                songNumberMap[key] = index + 1;
            });
            
            // Group songs by DJ
            const groups = {};
            songList.forEach(song => {
                if (!groups[song.dj_name]) {
                    groups[song.dj_name] = [];
                }
                groups[song.dj_name].push(song);
            });
            
            // Display each group
            Object.entries(groups).forEach(([djName, djSongs]) => {
                // DJ header
                const header = document.createElement('div');
                header.className = 'bg-purple-900/20 rounded-lg px-4 py-2 mt-4 mb-2';
                header.innerHTML = `<h3 class="font-semibold">ğŸ§ ${djName}</h3>`;
                container.appendChild(header);
                
                // DJ's songs
                djSongs.reverse().forEach((song, index) => {
                    const key = `${song.title}_${song.artist}_${song.timestamp}`;
                    const songNumber = songNumberMap[key];
                    const songEl = createSongElement(song, false, true, songNumber);
                    container.appendChild(songEl);
                });
            });
        }
        
        // Create song element
        function createSongElement(song, isLatest = false, hideDJ = false, songNumber = 0) {
            const div = document.createElement('div');
            div.className = `bg-gray-800/50 rounded-lg p-4 ${isLatest ? 'border border-purple-500 fade-in' : ''}`;
            
            // DJåã®è¡¨ç¤ºåˆ¤å®š: ç©ºæ–‡å­—ã€"DJ"ã®ã¿ã€hideDJãƒ•ãƒ©ã‚°ã‚’ãƒã‚§ãƒƒã‚¯
            const shouldHideDJ = hideDJ || 
                                !song.dj_name || 
                                song.dj_name.trim() === '' || 
                                song.dj_name.trim() === 'DJ';
            const djText = shouldHideDJ ? '' : ` (${song.dj_name})`;
            
            // [Now]ã‚¿ã‚°ã®è¡¨ç¤ºåˆ¤å®š: æœ€æ–°æ¥½æ›²ã‹ã¤5åˆ†ä»¥å†…
            let nowTag = '';
            if (isLatest && song.timestamp) {
                const songTime = new Date(song.timestamp);
                const now = new Date();
                const minutesElapsed = (now - songTime) / (1000 * 60);
                
                // 5åˆ†ä»¥å†…ãªã‚‰[Now]ã‚’è¡¨ç¤º
                if (minutesElapsed <= 5) {
                    nowTag = `[${translations[currentLanguage]['now.tag']}]`;
                }
            }
            
            // é€šã—ç•ªå·ã®è¡¨ç¤º
            const numberPrefix = songNumber > 0 ? `${songNumber}. ` : '';
            
            div.innerHTML = `
                <div class="font-medium"><span class="text-yellow-400">${nowTag}</span>${numberPrefix}${song.title} / ${song.artist}${djText}</div>
            `;
            
            return div;
        }
        
        // Filter by DJ
        function filterByDJ() {
            displaySongs();
        }
        
        // Share event
        async function shareEvent() {
            const url = window.location.href;
            const t = translations[currentLanguage];
            
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: eventData.name || t['share.title'],
                        text: t['share.text'],
                        url: url
                    });
                } catch (err) {
                    copyToClipboard(url);
                }
            } else {
                copyToClipboard(url);
            }
        }
        
        // Copy to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert(translations[currentLanguage]['share.copied']);
            });
        }
        
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (updateTimer) {
                clearInterval(updateTimer);
            }
        });
    </script>
</body>
</html>